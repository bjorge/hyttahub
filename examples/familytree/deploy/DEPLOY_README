## Deployment Instructions

This guide explains how to deploy the application and its backend services to Firebase.

### Prerequisites

1.  **Firebase Project**: You must have a Firebase project created.
2.  **Firebase CLI**: Install the Firebase CLI: `npm install -g firebase-tools` and log in with `firebase login`.
3.  **Google Cloud SDK**: Install the gcloud CLI to use `gsutil`: Install the gcloud CLI. Authenticate with `gcloud auth login`.
4.  **FlutterFire CLI**: Install the FlutterFire CLI: `dart pub global activate flutterfire_cli`.

### Step 1: Initial Setup

Before deploying for the first time, you need to configure your project-specific details.

1.  **Run the setup script:**
    ```sh
    ./setup.sh
    ```
    This will create a `config.sh` file.

2.  **Edit `config.sh`:**
    Open `deploy/config.sh` and replace the placeholder values with your actual Firebase project details. This file is ignored by Git.

3.  **Generate Firebase Options for Flutter:**
    From the root of the repository, run the FlutterFire configure command to generate `lib/firebase_options.dart`. This file is required by the Flutter app to connect to your Firebase project.
    ```sh
    # from the root of the project
    flutterfire configure
    ```
    **Note:** `lib/firebase_options.dart` should be added to your root `.gitignore` file to keep project secrets out of version control.

### Step 2: Deploying

Once setup is complete, you can use the following scripts to deploy different parts of the application.

1.  **Build the Web App:**
    This script cleans and builds the Flutter web application.
    ```sh
    ./build_web.sh
    ```

2.  **Deploy Hosting:**
    This deploys the web app to Firebase Hosting.
    ```sh
    ./deploy_web.sh
    ```

3.  **Deploy Firestore & Storage Rules:**
    This deploys the security rules for Firestore and Cloud Storage.
    ```sh
    ./deploy_rules.sh
    ```

4.  **Deploy Cloud Functions:**
    This deploys the cloud functions.
    Note: First build the functions inside the emulator docker/podman (running the docker/podman container will build them as well).
    ```sh
    ./deploy_functions.sh
    ```

5.  **Configure Storage CORS:**
    This script sets the Cross-Origin Resource Sharing (CORS) policy on your Cloud Storage bucket, which is necessary for the web app to load images.
    ```sh
    ./configure_cors.sh
    ```
    **Note:** If you use a custom domain, you will need to update the `WEB_APP_URL` in `config.sh` and re-run this script.


